<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lodge Information Kiosk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            cursor: none;
        }
        
        .slideshow-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .slide {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .slide.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 1s;
        }
        
        .slide img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .loading {
            color: white;
            font-family: Arial, sans-serif;
            font-size: 2em;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="slideshow-container" id="slideshow">
        <div class="loading">Loading slideshow...</div>
    </div>

    <script>
        // Configuration
        const SLIDE_DURATION = 10000; // 10 seconds per slide
        const IMAGES_JSON_URL = 'images.json'; // Generated by GitHub Action
        
        let images = [];
        let currentSlide = 0;
        let slideInterval;
        
        // Fetch list of images from JSON file
        async function fetchImageList() {
            try {
                const response = await fetch(IMAGES_JSON_URL);
                if (!response.ok) throw new Error('Failed to fetch image list');
                images = await response.json();
                
                if (images.length === 0) {
                    throw new Error('No images found');
                }
                
                console.log(`Loaded ${images.length} images`);
                return images;
            } catch (error) {
                console.error('Error fetching image list:', error);
                throw error;
            }
        }
        
        // Preload images
        function preloadImages() {
            return Promise.all(
                images.map(src => {
                    return new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = () => resolve(src);
                        img.onerror = () => {
                            console.warn(`Failed to load: ${src}`);
                            resolve(src); // Don't reject, just warn
                        };
                        img.src = src;
                    });
                })
            );
        }
        
        // Create slides
        function createSlides() {
            const container = document.getElementById('slideshow');
            container.innerHTML = '';
            
            images.forEach((src, index) => {
                const slide = document.createElement('div');
                slide.className = 'slide';
                if (index === 0) slide.classList.add('active');
                
                const img = document.createElement('img');
                img.src = src;
                img.alt = `Slide ${index + 1}`;
                
                slide.appendChild(img);
                container.appendChild(slide);
            });
        }
        
        // Show next slide
        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            slides[currentSlide].classList.remove('active');
            
            currentSlide = (currentSlide + 1) % images.length;
            slides[currentSlide].classList.add('active');
        }
        
        // Start slideshow
        function startSlideshow() {
            slideInterval = setInterval(nextSlide, SLIDE_DURATION);
        }
        
        // Initialize
        async function init() {
            try {
                await fetchImageList();
                await preloadImages();
                createSlides();
                startSlideshow();
            } catch (error) {
                document.getElementById('slideshow').innerHTML = 
                    '<div class="loading">Error loading slideshow.<br>Please check your images folder and connection.</div>';
            }
        }
        
        // Start everything
        init();
        
        // Prevent screen sleeping
        let wakeLock = null;
        if ('wakeLock' in navigator) {
            navigator.wakeLock.request('screen').then(lock => {
                wakeLock = lock;
            }).catch(err => {
                console.log('Wake Lock error:', err);
            });
        }
    </script>
</body>
</html>
